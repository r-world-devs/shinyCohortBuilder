(()=>{Shiny.addCustomMessageHandler("show_alert",(function(e){alert(e.info)})),Shiny.addCustomMessageHandler("pre_add_step_action",(function(e){$("#"+e.ns_prefix+"cb_container").find("div.cb_step .cb_rm_step").prop("disabled",!0),$("#"+e.ns_prefix+"cb_panel").find(".cb_add_step").blur()})),Shiny.addCustomMessageHandler("post_rm_step_action",(function(e){$("#"+e.ns_prefix+"cb_container").find("div.cb_step:last-child:not(:first-child) .cb_rm_step").prop("disabled",!1)})),Shiny.addCustomMessageHandler("inform_data_updated",(function(e){Shiny.setInputValue(e.ns_prefix+"cb_data_updated",e,{priority:"event"})})),Shiny.addCustomMessageHandler("update_na_count",(function(e){var t,a,i;$filter=(t=e.step_id,a=e.filter_id,i=e.ns_prefix,$("#"+i+t+' div.cb_filter[data-filter_id="'+a+'"]')),$filter.find(".cb_na_value").html(e.na_count)})),Shiny.addCustomMessageHandler("up_state",(function(e){Shiny.setInputValue(e.ns_prefix+"action",e,{priority:"event"})})),Shiny.addCustomMessageHandler("update_filter_class",(function(e){var t="#"+e.ns_prefix+e.step_id,a=$(t).find('div.cb_filter[data-filter_id="'+e.filter_id+'"] .cb_filter_content');e.show?a.removeClass(e.class):a.addClass(e.class)})),Shiny.addCustomMessageHandler("enable_panel",(function(e){$("#"+e.ns_prefix+"cb_panel").addClass("disabled"),!0===e.enable&&$("#"+e.ns_prefix+"cb_panel").removeClass("disabled")})),Shiny.addCustomMessageHandler("update_class",(function(e){var t;"add"==e.action&&($("#"+e.ns_prefix+e.step_id).addClass(e.class),t=!1),"remove"==e.action&&($("#"+e.ns_prefix+e.step_id).removeClass(e.class),t=!0),e.hasOwnProperty("disable")&&$("#"+e.ns_prefix+e.step_id).find(e.disable).prop("disabled",t)}));var e={};$(document).on("shiny:inputchanged",(function(t){if(t.target==document||Boolean(t.target.dataset.ignore))return!0;var a=t.target.closest(".cb_input");if(Boolean(a)){var i=a.closest(".cb_container").dataset.ns_prefix,n=a.closest(".cb_step")?.dataset?.step_id,s=a.closest(".cb_filter")?.dataset?.filter_id,d=Boolean("init"==a.dataset.exec_state),r=a.dataset.param,_=a.attributes.priority?.value;if("_update-mode_"==e[t.name]||d)e[t.name]=JSON.parse(JSON.stringify(t.value)),a.dataset.exec_state="active";else if(JSON.stringify(e[t.name])!=JSON.stringify(t.value)||"event"===_){var l=JSON.parse(JSON.stringify(t.value));e[t.name]=l,Shiny.setInputValue(i+"action",{id:"update_filter",params:{step_id:n,filter_id:s,input_value:l,input_name:r,binding:t.inputType,run_flow:!1}},{priority:"event"})}}})),$(document).on("shiny:updateinput",(function(t){Boolean(t.target.closest(".cb_input"))&&(e[t.target.id]="_update-mode_")}))})();